<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Fiscal Policy, Regulation & Federal Reserve Tools — CS 20–21 (OST Review)</title>
  <link rel="stylesheet" href="../styles.css"/>

  <style>
    :root{
      --bg:#0b1220;
      --card:#111a2f;
      --text:#e7eefc;
      --muted:#a8b4cf;
      --line:rgba(255,255,255,.12);
      --good:#2bd576;
      --bad:#ff5c7a;
      --warn:#ffd166;
      --accent:#7aa2ff;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --radius:18px;
      --shadow:0 18px 55px rgba(0,0,0,.40);
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
      background:linear-gradient(180deg,#0b1220,#070b14);
      color:var(--text);
      min-height:100vh;
      display:flex;
      justify-content:center;
      align-items:flex-start;
      padding:22px;
    }
    .app{width:min(980px,100%);}
    .top{
      display:flex;gap:14px;align-items:flex-start;justify-content:space-between;
      margin-bottom:14px;
    }
    .kicker{letter-spacing:.12em;font-weight:800;color:var(--muted);font-size:12px}
    h1{margin:6px 0 6px;font-size:22px}
    .sub{margin:0;color:var(--muted);line-height:1.4}
    .panel{
      background:rgba(255,255,255,.03);
      border:1px solid var(--line);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:16px;
    }
    .row{
      display:flex;gap:10px;align-items:center;justify-content:space-between;
      flex-wrap:wrap;
    }
    .pill{
      border:1px solid var(--line);
      padding:6px 10px;border-radius:999px;
      color:var(--muted);font-size:12px;
      background:rgba(255,255,255,.02);
    }
    .grid{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:10px;
      margin-top:12px;
    }
    @media (max-width:820px){ .grid{grid-template-columns:1fr;} }
    .box{
      border:1px solid var(--line);
      background:rgba(255,255,255,.02);
      border-radius:14px;
      padding:12px;
    }
    .label{color:var(--muted);font-size:12px;margin-bottom:4px}
    .value{font-weight:800}
    .hr{height:1px;background:var(--line);margin:12px 0}
    .qhead{
      display:flex;align-items:flex-start;justify-content:space-between;gap:10px;flex-wrap:wrap;
    }
    .qnum{color:var(--muted);font-size:12px}
    .tag{
      font-size:12px;
      padding:4px 8px;border-radius:999px;
      border:1px solid var(--line);
      background:rgba(255,255,255,.02);
      color:var(--muted);
    }
    .tag.released{border-color:rgba(122,162,255,.45);color:#cfe0ff;}
    .prompt{margin:8px 0 10px;font-size:16px;line-height:1.35}
    .choice{
      border:1px solid var(--line);
      background:rgba(255,255,255,.02);
      border-radius:14px;
      padding:10px 12px;
      margin:8px 0;
      cursor:pointer;
      user-select:none;
    }
    .choice:hover{border-color:rgba(122,162,255,.55);}
    .choice.sel{outline:2px solid rgba(122,162,255,.55);border-color:rgba(122,162,255,.65);}
    .controls{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
    button{
      border-radius:14px;
      border:1px solid var(--line);
      background:rgba(255,255,255,.03);
      color:var(--text);
      padding:10px 14px;
      font-weight:900;
      cursor:pointer;
    }
    button:hover{border-color:rgba(122,162,255,.60);}
    button:disabled{opacity:.45;cursor:not-allowed}
    .msg{
      margin-top:10px;
      border-radius:14px;
      border:1px solid var(--line);
      padding:10px 12px;
      display:none;
    }
    .msg.good{display:block;border-color:rgba(43,213,118,.45);background:rgba(43,213,118,.08)}
    .msg.bad{display:block;border-color:rgba(255,92,122,.45);background:rgba(255,92,122,.08)}
    .msg.warn{display:block;border-color:rgba(255,209,102,.55);background:rgba(255,209,102,.08)}
    .mono{font-family:var(--mono)}
    .startScreen{
      display:grid;gap:10px;
    }
    input{
      width:100%;
      border-radius:14px;
      border:1px solid var(--line);
      background:rgba(255,255,255,.02);
      color:var(--text);
      padding:10px 12px;
      outline:none;
    }
    input:focus{border-color:rgba(122,162,255,.65);}
    .ticket{
      border:1px solid rgba(43,213,118,.45);
      background:rgba(43,213,118,.08);
      border-radius:16px;
      padding:14px;
    }
    .ticket h2{margin:0 0 8px;font-size:18px}
    .ticket pre{
      white-space:pre-wrap;
      margin:0;
      padding:10px;
      border-radius:14px;
      border:1px solid var(--line);
      background:rgba(0,0,0,.25);
      font-family:var(--mono);
      font-size:12px;
      color:#eaf0ff;
    }
    .errorBox{
      display:none;
      margin-top:10px;
      border-radius:14px;
      border:1px solid rgba(255,92,122,.45);
      background:rgba(255,92,122,.08);
      padding:10px 12px;
      color:#ffd7df;
      font-family:var(--mono);
      font-size:12px;
    }
  </style>
</head>

<body>
<div class="app">
  <div class="top">
    <div>
      <div class="kicker">LEGEND — GOVERNMENT OST REVIEW</div>
      <h1>Fiscal Policy, Regulation & Federal Reserve Tools — CS 20–21</h1>
      <p class="sub">
        Released items used verbatim first, supplemented for practice. Mastery = finish all questions with <b>100% accuracy</b>.
        Submission ticket required (name + start/end + runtime).
      </p>
    </div>
    <div class="row" style="gap:8px;justify-content:flex-end;">
      <div class="pill">40+ items ✅</div>
      <div class="pill">Fed tools reps ✅</div>
      <div class="pill">Ticket ✅</div>
    </div>
  </div>

  <div class="panel" id="panel">
    <!-- Start screen injected here -->
  </div>

  <div class="errorBox" id="errorBox"></div>
</div>

<script>
(() => {
  "use strict";

  // Hardened shell: surface errors on-page (white-screen killer)
  const errorBox = document.getElementById("errorBox");
  window.addEventListener("error", (e) => {
    errorBox.style.display = "block";
    errorBox.textContent = `[ERROR] ${e.message}\n${e.filename}:${e.lineno}:${e.colno}`;
  });
  window.addEventListener("unhandledrejection", (e) => {
    errorBox.style.display = "block";
    errorBox.textContent = `[PROMISE ERROR] ${String(e.reason || e)}`;
  });

  // ===== Released items (verbatim) pulled from your released bank (CS20–21) =====
  // NOTE: tagged released:true so you can see what's verbatim vs supplemental.
  const QUESTIONS = [
    // --- Released: Fiscal policy (checkbox item converted into MCQs while keeping the item text verbatim in stem/options)
    { released:true, stem:`Encourage Growth: ☑ cut income tax rates`, choices:[
      "Encourage economic growth (expansionary fiscal policy)",
      "Slow economic growth (contractionary fiscal policy)",
      "Monetary policy that reduces reserves",
      "Regulatory policy that increases costs"
    ], correct:0, hint:"Tax cuts are expansionary fiscal policy: more take-home pay → more spending." },

    { released:true, stem:`Encourage Growth: ☑ fund large infrastructure project`, choices:[
      "Encourage economic growth (expansionary fiscal policy)",
      "Slow economic growth (contractionary fiscal policy)",
      "Monetary policy: sell government securities",
      "Regulatory policy: consumer protections"
    ], correct:0, hint:"Government spending increases aggregate demand." },

    { released:true, stem:`Slow Growth: ☑ increase corporate taxes`, choices:[
      "Encourage growth",
      "Slow growth",
      "Monetary policy",
      "Private investment policy"
    ], correct:1, hint:"Higher taxes reduce spending/investment incentives (contractionary)." },

    { released:true, stem:`Slow Growth: ☑ reduce government spending`, choices:[
      "Encourage growth",
      "Slow growth",
      "Monetary policy",
      "Regulatory policy"
    ], correct:1, hint:"Less government spending reduces demand (contractionary)." },

    { released:true, stem:`Why do companies object to EPA regulations?`, choices:[
      "A. increases money in circulation",
      "B. increases costs & reduces profit",
      "C. overturned by state policies",
      "D. reduces government spending and consumer demand"
    ], correct:1, hint:"Regulation can raise compliance costs." },

    { released:true, stem:`Q8, Q26, Q129: The government has enacted a law requiring the installation of seat belts in new cars. What is the intended benefit of this type of increased government regulation?`, choices:[
      "a) To increase tax revenue",
      "b) To promote economic growth",
      "c) To reduce private sector profits",
      "d) To enhance consumer protections"
    ], correct:3, hint:"Safety rules protect consumers." },

    // Released matching item converted into 4 MCQs (keeping scenario text verbatim)
    { released:true, stem:`Q15, Q34, Q92, Q137: The government decides to begin a massive effort to rebuild the nation’s highways. Is this related to taxes or spending?`, choices:[
      "Spending Policy",
      "Taxing Policy",
      "Monetary Policy",
      "Regulatory Policy"
    ], correct:0, hint:"Rebuilding highways = government spending." },

    { released:true, stem:`Q15, Q34, Q92, Q137: The government increases deductions for households with students attending college. Is this related to taxes or spending?`, choices:[
      "Spending Policy",
      "Taxing Policy",
      "Monetary Policy",
      "Regulatory Policy"
    ], correct:1, hint:"Deductions change the tax code." },

    { released:true, stem:`Q15, Q34, Q92, Q137: The government has extended unemployment benefits for an additional six weeks. Is this related to taxes or spending?`, choices:[
      "Spending Policy",
      "Taxing Policy",
      "Monetary Policy",
      "Regulatory Policy"
    ], correct:0, hint:"Benefits are direct spending." },

    { released:true, stem:`Q15, Q34, Q92, Q137: The government has increased fees for consumption of gasoline. Is this related to taxes or spending?`, choices:[
      "Spending Policy",
      "Taxing Policy",
      "Monetary Policy",
      "Regulatory Policy"
    ], correct:1, hint:"Fees/taxes raise revenue." },

    { released:true, stem:`Q163: The federal government controls taxation and spending policy. These are both parts of ___ policy. If the government were to raise taxes and decrease spending, this would be an example of an attempt to ___ economic growth.`, choices:[
      "Fiscal; Encourage",
      "Fiscal; Slow",
      "Monetary; Encourage",
      "Monetary; Slow"
    ], correct:1, hint:"Raise taxes + cut spending = contractionary fiscal policy." },

    { released:true, stem:`Q22, Q44, Q147: What is one outcome the Federal Reserve might want to produce when purchasing government securities?`, choices:[
      "a) Increasing interest rates",
      "b) Reducing the money supply",
      "c) Fostering economic expansion",
      "d) Fostering economic contraction"
    ], correct:2, hint:"Buying securities injects money → expansion." },

    { released:true, stem:`Q52: What is the effect when the Federal Reserve increases interest rates?`, choices:[
      "a) The cost of taking out loans increases",
      "b) Consumers spend more on the economy",
      "c) The Government receives a large increase in tax revenue",
      "d) Sudden inflation causes the prices of goods and services to go up"
    ], correct:0, hint:"Higher rates make borrowing more expensive." },

    // ===== Supplemental (high-rep tool manipulation + cause/effect) =====

    // Fiscal: identify tool + intended direction
    { stem:`The economy is in a recession and unemployment is rising. Which fiscal policy is MOST likely intended to encourage economic growth?`, choices:[
      "Increase government spending on infrastructure",
      "Increase income tax rates",
      "Reduce unemployment benefits",
      "Decrease government spending"
    ], correct:0, hint:"Expansionary fiscal = ↑spending and/or ↓taxes." },

    { stem:`Inflation is rising quickly. Which fiscal policy is MOST likely intended to slow economic growth?`, choices:[
      "Decrease government spending and increase taxes",
      "Decrease reserve requirements",
      "Buy government bonds",
      "Lower interest rates"
    ], correct:0, hint:"Contractionary fiscal = ↓spending and/or ↑taxes." },

    { stem:`Which choice is an example of a TAX policy (not spending) used in fiscal policy?`, choices:[
      "Cutting income tax rates",
      "Building new highways",
      "Extending unemployment benefits",
      "Hiring more federal workers for a new agency"
    ], correct:0, hint:"Tax policy changes revenue rules." },

    { stem:`Which choice is an example of SPENDING policy (not taxes) used in fiscal policy?`, choices:[
      "Funding a large public-works project",
      "Raising gasoline fees",
      "Increasing corporate tax rates",
      "Reducing deductions for households"
    ], correct:0, hint:"Spending = direct outlays." },

    // Regulation: costs/benefits
    { stem:`A new regulation requires factories to install expensive filters to reduce air pollution. Which is the MOST likely economic cost?`, choices:[
      "Lower corporate profits due to higher operating costs",
      "Higher money supply due to bond purchases",
      "Lower reserve requirement at banks",
      "Lower interest rates automatically"
    ], correct:0, hint:"Compliance costs can reduce profits." },

    { stem:`A regulation bans false advertising and requires clear labeling of ingredients. What is the MOST likely intended benefit?`, choices:[
      "Enhancing consumer protections",
      "Reducing the money supply",
      "Increasing interest rates",
      "Increasing corporate taxes"
    ], correct:0, hint:"Consumer protection is a core regulatory benefit." },

    { stem:`Why might businesses argue regulations can slow economic growth?`, choices:[
      "They increase production costs and can reduce investment",
      "They always reduce inflation immediately",
      "They increase the money supply directly",
      "They automatically lower taxes"
    ], correct:0, hint:"Higher costs can reduce hiring and expansion." },

    // Monetary tools: open market operations, reserve requirement, discount rate
    { stem:`The Federal Reserve wants to encourage economic growth. Which open market action best matches that goal?`, choices:[
      "Buy government securities",
      "Sell government securities",
      "Raise reserve requirements",
      "Raise interest rates"
    ], correct:0, hint:"Buying securities increases bank reserves." },

    { stem:`The Federal Reserve wants to slow an overheating economy. Which open market action best matches that goal?`, choices:[
      "Sell government securities",
      "Buy government securities",
      "Lower interest rates",
      "Lower reserve requirements"
    ], correct:0, hint:"Selling securities pulls money out." },

    { stem:`When the Fed buys government securities, what happens FIRST in the banking system?`, choices:[
      "Bank reserves increase",
      "Reserve requirements increase",
      "Taxes increase",
      "Government spending automatically decreases"
    ], correct:0, hint:"Buying securities injects money into banks." },

    { stem:`If the Fed sells government securities, what is the MOST likely outcome?`, choices:[
      "Money supply decreases and interest rates tend to rise",
      "Money supply increases and interest rates tend to fall",
      "Taxes fall automatically",
      "Government spending increases automatically"
    ], correct:0, hint:"Selling bonds pulls money out." },

    { stem:`To encourage economic growth, the Fed could reduce the amount of money banks must keep on reserve. This tool is called changing the…`, choices:[
      "Reserve requirement",
      "Income tax rate",
      "Corporate tax deduction",
      "Regulatory compliance standard"
    ], correct:0, hint:"Lower reserves → more loans." },

    { stem:`If reserve requirements are INCREASED, banks can make…`, choices:[
      "Fewer loans, reducing money creation",
      "More loans, increasing money creation",
      "More loans, but only to the government",
      "No change in lending"
    ], correct:0, hint:"More required reserves = less lendable money." },

    { stem:`The Fed raises the discount rate (the rate banks pay to borrow from the Fed). What is the MOST likely effect?`, choices:[
      "Banks borrow less and make fewer loans",
      "Banks borrow more and make more loans",
      "Taxes immediately rise",
      "Regulations automatically loosen"
    ], correct:0, hint:"Higher borrowing costs reduce lending." },

    { stem:`If the Fed wants banks to lend MORE, which is the BEST choice?`, choices:[
      "Lower the discount rate",
      "Raise the discount rate",
      "Sell government securities",
      "Increase reserve requirements"
    ], correct:0, hint:"Cheaper borrowing encourages lending." },

    { stem:`The Fed increases interest rates to slow growth. Which outcome is MOST likely?`, choices:[
      "Consumers and businesses borrow less",
      "Consumers borrow more",
      "Government spending automatically increases",
      "Inflation always disappears immediately"
    ], correct:0, hint:"Higher rates reduce borrowing/spending." },

    { stem:`Which action is MOST likely to fight high inflation using monetary policy?`, choices:[
      "Raise interest rates and sell government securities",
      "Lower interest rates and buy government securities",
      "Lower taxes and increase spending",
      "Increase unemployment benefits"
    ], correct:0, hint:"Contractionary monetary reduces demand." },

    { stem:`Which action is MOST likely to reduce unemployment during a recession using monetary policy?`, choices:[
      "Lower interest rates and buy government securities",
      "Raise interest rates and sell government securities",
      "Increase reserve requirements",
      "Raise the discount rate"
    ], correct:0, hint:"Expansionary monetary increases loans/spending." },

    // Tool-identification (students confuse fiscal vs monetary vs regulation)
    { stem:`Which is an example of MONETARY policy (Fed action), not fiscal policy?`, choices:[
      "Buying government securities",
      "Cutting income tax rates",
      "Funding a highway rebuilding project",
      "Passing seat belt requirements"
    ], correct:0, hint:"Monetary = Fed controls money supply." },

    { stem:`Which is an example of REGULATORY policy, not fiscal or monetary?`, choices:[
      "Requiring seat belts in new cars",
      "Lowering interest rates",
      "Increasing government spending",
      "Cutting income tax rates"
    ], correct:0, hint:"Regulation = rules on behavior/industry." },

    { stem:`Which is an example of FISCAL policy, not monetary policy?`, choices:[
      "Increasing corporate taxes",
      "Selling government securities",
      "Lowering reserve requirements",
      "Lowering the discount rate"
    ], correct:0, hint:"Fiscal = taxes/spending by government." },

    // Multi-step reasoning (cause → effect)
    { stem:`The Fed buys government securities. Which chain best explains the likely result?`, choices:[
      "Reserves increase → banks lend more → money supply rises → growth encouraged",
      "Reserves decrease → banks lend more → money supply falls → growth encouraged",
      "Reserves increase → banks lend less → money supply falls → growth encouraged",
      "Reserves decrease → banks lend less → money supply rises → growth encouraged"
    ], correct:0, hint:"Buying securities increases lending capacity." },

    { stem:`The Fed sells government securities. Which chain best explains the likely result?`, choices:[
      "Reserves fall → banks lend less → money supply falls → growth slows",
      "Reserves rise → banks lend more → money supply rises → growth slows",
      "Reserves fall → banks lend more → money supply rises → growth slows",
      "Reserves rise → banks lend less → money supply falls → growth slows"
    ], correct:0, hint:"Selling securities reduces reserves." },

    // Fiscal side chains
    { stem:`Government increases spending during a recession. Which is the MOST likely goal?`, choices:[
      "Increase demand and encourage growth",
      "Reduce demand and slow growth",
      "Reduce money supply",
      "Increase reserve requirements"
    ], correct:0, hint:"More spending can stimulate demand." },

    { stem:`Government raises taxes and cuts spending. Which is the MOST likely goal?`, choices:[
      "Slow economic growth and reduce inflation pressure",
      "Encourage growth and reduce unemployment",
      "Increase money supply",
      "Increase bank reserves"
    ], correct:0, hint:"Contractionary fiscal cools the economy." },

    // Regulation: balancing common good vs profit (application)
    { stem:`A regulation requires child-safety locks on medicine bottles. Which pair best matches the tradeoff?`, choices:[
      "Benefit: consumer protection; Cost: higher production costs",
      "Benefit: more money supply; Cost: higher reserve requirements",
      "Benefit: lower taxes; Cost: reduced government spending",
      "Benefit: lower interest rates; Cost: fewer loans"
    ], correct:0, hint:"Safety benefits can cost firms more." },

    // More Fed tool recognition practice
    { stem:`Which Fed tool directly changes how much money banks must keep and not lend out?`, choices:[
      "Reserve requirement",
      "Capital gains tax",
      "Regulatory enforcement action",
      "Fiscal spending"
    ], correct:0, hint:"Reserves determine lending capacity." },

    { stem:`Which Fed tool involves banks borrowing directly from the Federal Reserve?`, choices:[
      "Discount rate",
      "Income tax rate",
      "Sales tax rate",
      "EPA regulation"
    ], correct:0, hint:"Discount window borrowing." },

    { stem:`If the Fed wants borrowing to be cheaper for consumers, it should generally…`, choices:[
      "Lower interest rates",
      "Raise interest rates",
      "Sell government securities",
      "Increase reserve requirements"
    ], correct:0, hint:"Lower rates reduce loan costs." },

    { stem:`If the Fed raises interest rates, what is the MOST likely effect on inflation (all else equal)?`, choices:[
      "Inflation pressure tends to decrease",
      "Inflation pressure tends to increase",
      "Inflation is unaffected",
      "Inflation always becomes zero immediately"
    ], correct:0, hint:"Higher rates reduce spending demand." },

    // Application: picking best tool for scenario
    { stem:`Unemployment is high and inflation is low. Which Fed action is MOST appropriate to encourage expansion?`, choices:[
      "Buy government securities and lower interest rates",
      "Sell government securities and raise interest rates",
      "Increase reserve requirements",
      "Raise the discount rate"
    ], correct:0, hint:"Expansionary monetary." },

    { stem:`Inflation is high and the economy is overheating. Which Fed action is MOST appropriate to slow expansion?`, choices:[
      "Sell government securities and raise interest rates",
      "Buy government securities and lower interest rates",
      "Lower reserve requirements",
      "Lower the discount rate"
    ], correct:0, hint:"Contractionary monetary." },

    // Mixed confusion checks
    { stem:`Which is the BEST example of a regulation that “prohibits unfair business practices”?`, choices:[
      "A law against deceptive advertising claims",
      "The Fed buying securities",
      "A cut to income tax rates",
      "An infrastructure spending bill"
    ], correct:0, hint:"Unfair practices = consumer protection regulation." },

    { stem:`Which statement best explains why fiscal policy and monetary policy can both affect economic growth?`, choices:[
      "Fiscal changes taxes/spending; monetary changes money supply/interest rates—both influence demand",
      "Both are controlled only by states",
      "Both mainly affect foreign policy",
      "Both work only through court decisions"
    ], correct:0, hint:"Different levers, same macro targets." },

    // Extra reps (students need them)
    { stem:`If banks have MORE reserves available, they can generally…`, choices:[
      "Make more loans, increasing money creation",
      "Make fewer loans, decreasing money creation",
      "Only lend to the government",
      "Not change lending behavior"
    ], correct:0, hint:"Loans create deposits (money creation)." },

    { stem:`Which action is MOST likely to increase the money supply?`, choices:[
      "The Fed buys government securities",
      "The Fed sells government securities",
      "The Fed increases reserve requirements",
      "The Fed raises the discount rate"
    ], correct:0, hint:"Buying securities injects money." },

    { stem:`Which action is MOST likely to decrease the money supply?`, choices:[
      "The Fed sells government securities",
      "The Fed buys government securities",
      "The Fed lowers the discount rate",
      "The Fed lowers reserve requirements"
    ], correct:0, hint:"Selling pulls money out." },

    { stem:`A company supports fewer regulations because it wants to maximize profits. Which reasoning best matches that position?`, choices:[
      "Regulations can increase costs and reduce profit margins",
      "Regulations automatically reduce taxes",
      "Regulations increase money in circulation",
      "Regulations lower interest rates"
    ], correct:0, hint:"Compliance costs reduce profits." },

    { stem:`Which option is the BEST example of government using fiscal policy to slow growth?`, choices:[
      "Raising taxes and decreasing government spending",
      "Lowering interest rates",
      "Buying government securities",
      "Lowering reserve requirements"
    ], correct:0, hint:"Contractionary fiscal." },

    { stem:`Which option is the BEST example of government using fiscal policy to encourage growth?`, choices:[
      "Lowering taxes and increasing government spending",
      "Raising interest rates",
      "Selling government securities",
      "Increasing reserve requirements"
    ], correct:0, hint:"Expansionary fiscal." },

    // Final tool differentiation capstone
    { stem:`A policy maker says: “We need the Fed to cool inflation without Congress changing taxes.” Which tool set best matches?`, choices:[
      "Sell government securities + raise interest rates",
      "Cut income taxes + increase spending",
      "Seat belt regulation + consumer labeling",
      "Increase unemployment benefits + cut corporate taxes"
    ], correct:0, hint:"Fed = monetary tools, not taxes/spending." },
  ];

  // ===== UI / Game State =====
  const panel = document.getElementById("panel");

  let studentName = "";
  let startedAt = null;
  let endedAt = null;

  let idx = 0;
  let attempts = 0;
  let correct = 0;
  let selected = null;
  let locked = false; // lock after correct until next

  const fmt = (d) => {
    const pad = (n)=> String(n).padStart(2,"0");
    return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())} ${pad(d.getHours())}:${pad(d.getMinutes())}:${pad(d.getSeconds())}`;
  };

  const msToHMS = (ms) => {
    const s = Math.max(0, Math.floor(ms/1000));
    const hh = Math.floor(s/3600);
    const mm = Math.floor((s%3600)/60);
    const ss = s%60;
    const pad = (n)=> String(n).padStart(2,"0");
    return `${pad(hh)}:${pad(mm)}:${pad(ss)}`;
  };

  const hashCode = (str) => {
    // simple deterministic hash for ticket
    let h = 2166136261;
    for (let i=0;i<str.length;i++){
      h ^= str.charCodeAt(i);
      h = Math.imul(h, 16777619);
    }
    return (h>>>0).toString(16).toUpperCase().padStart(8,"0");
  };

  function renderStart(){
    panel.innerHTML = `
      <div class="startScreen">
        <div class="box">
          <div class="label">Student Name (required)</div>
          <input id="nameInput" placeholder="Type first + last name"/>
          <div class="label" style="margin-top:8px">Rules</div>
          <div class="value" style="font-weight:700;color:var(--muted);line-height:1.45">
            • You must answer <b>every</b> question with <b>0 misses</b> (100% accuracy).<br/>
            • If you miss any question, you must restart to earn mastery.<br/>
            • A submission ticket appears only when mastery is achieved.
          </div>
        </div>
        <div class="controls">
          <button id="startBtn">Start</button>
        </div>
      </div>
    `;

    const nameInput = document.getElementById("nameInput");
    const startBtn = document.getElementById("startBtn");
    startBtn.onclick = () => {
      const v = (nameInput.value || "").trim();
      if(!v) return alert("Please enter your name.");
      studentName = v;
      startedAt = new Date();
      idx = 0; attempts = 0; correct = 0; selected = null; locked=false;
      renderGame();
    };
  }

  function renderGame(){
    const q = QUESTIONS[idx];
    const acc = attempts ? Math.round((correct/attempts)*100) : 100;

    panel.innerHTML = `
      <div class="grid">
        <div class="box">
          <div class="label">Student</div>
          <div class="value">${escapeHtml(studentName)}</div>
        </div>
        <div class="box">
          <div class="label">Progress</div>
          <div class="value">${idx+1} / ${QUESTIONS.length}</div>
        </div>
        <div class="box">
          <div class="label">Accuracy</div>
          <div class="value">${acc}%</div>
        </div>
        <div class="box">
          <div class="label">Start Time</div>
          <div class="value mono">${fmt(startedAt)}</div>
        </div>
      </div>

      <div class="hr"></div>

      <div class="qhead">
        <div class="qnum">Question ${idx+1} of ${QUESTIONS.length}</div>
        <div class="tag ${q.released ? "released" : ""}">${q.released ? "RELEASED (verbatim)" : "SUPPLEMENTAL (CS-aligned)"}</div>
      </div>

      <div class="prompt">${escapeHtml(q.stem)}</div>

      <div id="choices"></div>

      <div id="msg" class="msg"></div>

      <div class="controls">
        <button id="submitBtn">Submit</button>
        <button id="hintBtn" disabled>Hint</button>
        <button id="nextBtn" disabled>Next</button>
        <button id="restartBtn">Restart</button>
      </div>
    `;

    const choicesDiv = document.getElementById("choices");
    q.choices.forEach((text, i) => {
      const div = document.createElement("div");
      div.className = "choice";
      div.textContent = text;
      div.addEventListener("click", () => {
        if(locked) return;
        selected = i;
        [...choicesDiv.children].forEach(n => n.classList.remove("sel"));
        div.classList.add("sel");
      });
      choicesDiv.appendChild(div);
    });

    const msg = document.getElementById("msg");
    const submitBtn = document.getElementById("submitBtn");
    const hintBtn = document.getElementById("hintBtn");
    const nextBtn = document.getElementById("nextBtn");
    const restartBtn = document.getElementById("restartBtn");

    function setMsg(kind, text){
      msg.className = "msg " + kind;
      msg.textContent = text;
    }

    submitBtn.onclick = () => {
      if(locked) return;
      if(selected === null) return alert("Select an answer.");
      attempts++;

      if(selected === q.correct){
        correct++;
        locked = true;
        setMsg("good", "Correct. Click Next.");
        nextBtn.disabled = false;
        hintBtn.disabled = true;
      } else {
        // mastery rule: any miss means no mastery; allow hint + retry on same item, but accuracy stays impacted
        setMsg("bad", "Incorrect. Use the hint, then try again (accuracy will reflect the miss).");
        hintBtn.disabled = false;
      }
    };

    hintBtn.onclick = () => {
      setMsg("warn", "Hint: " + q.hint);
      hintBtn.disabled = true;
    };

    nextBtn.onclick = () => {
      idx++;
      locked = false;
      selected = null;

      if(idx >= QUESTIONS.length){
        endedAt = new Date();
        const finalAcc = attempts ? Math.round((correct/attempts)*100) : 0;
        if(finalAcc === 100 && attempts === QUESTIONS.length){
          renderTicket();
        } else {
          alert("No mastery yet (100% required). Restart and try again.");
          renderStart();
        }
      } else {
        renderGame();
      }
    };

    restartBtn.onclick = () => {
      if(!confirm("Restart the game? This will reset progress.")) return;
      startedAt = new Date();
      idx = 0; attempts = 0; correct = 0; selected = null; locked=false;
      renderGame();
    };
  }

  function renderTicket(){
    const runtimeMs = endedAt - startedAt;
    const runtime = msToHMS(runtimeMs);
    const dateStr = fmt(new Date()).slice(0,10);

    const payload = [
      "GOV-OST-CS20-21",
      studentName,
      fmt(startedAt),
      fmt(endedAt),
      runtime,
      `Score:${correct}/${attempts}`
    ].join("|");

    const code = hashCode(payload);

    panel.innerHTML = `
      <div class="ticket">
        <h2>✅ Mastery Ticket (100%)</h2>
        <p class="sub" style="margin:0 0 10px">
          Screenshot this entire ticket (no cropping). Submit in Google Classroom.
        </p>
        <pre>
STUDENT: ${studentName}
DATE: ${dateStr}
START: ${fmt(startedAt)}
END:   ${fmt(endedAt)}
RUNTIME: ${runtime}
SCORE: ${correct}/${attempts} (100%)

SUBMISSION CODE: ${code}
        </pre>
      </div>
      <div class="controls" style="margin-top:12px">
        <button id="playAgain">Play Again</button>
      </div>
    `;
    document.getElementById("playAgain").onclick = () => renderStart();
  }

  function escapeHtml(s){
    return String(s)
      .replaceAll("&","&amp;")
      .replaceAll("<","&lt;")
      .replaceAll(">","&gt;")
      .replaceAll('"',"&quot;")
      .replaceAll("'","&#039;");
  }

  // Start
  renderStart();
})();
</script>
</body>
</html>
