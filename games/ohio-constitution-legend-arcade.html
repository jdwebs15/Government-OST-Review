<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Ohio Constitution ‚Äî Legend Arcade Edition</title>

  <!-- IMPORTANT: from /games folder back to repo root -->
  <link rel="stylesheet" href="../styles.css" />

  <style>
    /* --- Arcade-only visuals (isolated to this file) --- */
    :root{
      --arcadeCard: rgba(15,23,42,.88);
      --arcadeBorder: rgba(255,255,255,.12);
      --accent:#38bdf8;
      --good:#22c55e;
      --bad:#ef4444;
      --gold:#facc15;
    }

    .arcadeWrap{
      width:min(980px,92vw);
      margin:26px auto 46px;
    }

    .arcadeTop{
      display:flex;
      justify-content:space-between;
      gap:16px;
      align-items:flex-start;
      margin-bottom:14px;
    }

    .arcadeTitle h1{
      margin:6px 0 6px;
      font-size:28px;
      letter-spacing:.2px;
    }
    .arcadeTitle .sub{
      margin:0;
      color:var(--muted);
      max-width:760px;
      line-height:1.35;
    }

    .arcadeCard{
      background:var(--arcadeCard);
      border:1px solid var(--arcadeBorder);
      border-radius:18px;
      padding:18px;
      box-shadow: var(--shadow);
      backdrop-filter: blur(8px);
      position:relative;
      overflow:hidden;
    }

    .statRow{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      align-items:center;
      justify-content:space-between;
      margin:12px 0 12px;
      font-weight:800;
    }

    .statGroup{
      display:flex;
      flex-wrap:wrap;
      gap:12px;
      align-items:center;
    }

    .badge{
      padding:6px 12px;
      border-radius:999px;
      font-size:12px;
      background:rgba(250,204,21,.16);
      border:1px solid rgba(250,204,21,.55);
      color:var(--text);
      letter-spacing:.06em;
      text-transform:uppercase;
    }

    .progressbar{
      height:8px;
      background:rgba(255,255,255,.06);
      border-radius:999px;
      overflow:hidden;
      margin:10px 0 14px;
    }
    .progress{
      height:100%;
      width:0%;
      background:linear-gradient(90deg,#38bdf8,#22d3ee);
      transition:.35s ease;
    }

    #question h3{
      margin:0 0 8px;
      font-size:16px;
      color:var(--muted);
      letter-spacing:.06em;
      text-transform:uppercase;
    }
    #question .qtext{
      font-size:18px;
      line-height:1.35;
      margin-bottom:10px;
    }

    .choice{
      margin:10px 0;
      padding:12px 14px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.12);
      cursor:pointer;
      transition:.2s ease;
      user-select:none;
      background:rgba(255,255,255,.02);
    }
    .choice:hover{
      border-color:rgba(56,189,248,.55);
      background:rgba(56,189,248,.08);
    }
    .choice.sel{
      outline:2px solid rgba(56,189,248,.55);
      background:rgba(56,189,248,.10);
    }
    .choice.correct{
      background:rgba(34,197,94,.18);
      border-color:rgba(34,197,94,.55);
    }
    .choice.wrong{
      background:rgba(239,68,68,.18);
      border-color:rgba(239,68,68,.55);
    }

    .btnRow{
      display:flex;
      gap:10px;
      margin-top:12px;
      flex-wrap:wrap;
    }
    .btn{
      padding:10px 14px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(255,255,255,.04);
      color:var(--text);
      font-weight:900;
      cursor:pointer;
      transition:.15s ease;
    }
    .btn.primary{
      border:none;
      background:linear-gradient(90deg,#38bdf8,#22d3ee);
      color:#071018;
    }
    .btn:hover{ transform: translateY(-1px); }

    .ticket{
      margin-top:16px;
      padding:14px;
      border-radius:16px;
      background:rgba(34,197,94,.12);
      border:1px solid rgba(34,197,94,.55);
      color:var(--text);
      line-height:1.45;
    }

    /* ===== FX Animations ===== */
    @keyframes shake{
      0%,100%{ transform: translate3d(0,0,0); }
      10%{ transform: translate3d(-6px,2px,0) rotate(-.4deg); }
      20%{ transform: translate3d(6px,-2px,0) rotate(.4deg); }
      30%{ transform: translate3d(-5px,1px,0) rotate(-.3deg); }
      40%{ transform: translate3d(5px,-1px,0) rotate(.3deg); }
      50%{ transform: translate3d(-4px,1px,0) rotate(-.2deg); }
      60%{ transform: translate3d(4px,-1px,0) rotate(.2deg); }
      70%{ transform: translate3d(-3px,1px,0) rotate(-.15deg); }
      80%{ transform: translate3d(3px,-1px,0) rotate(.15deg); }
      90%{ transform: translate3d(-2px,1px,0) rotate(-.1deg); }
    }
    .arcadeCard.shake{ animation: shake 520ms ease-in-out; }

    @keyframes xpGlow{
      0%{ text-shadow:0 0 0 rgba(56,189,248,0); transform:scale(1); }
      40%{ text-shadow:0 0 18px rgba(56,189,248,.85),0 0 36px rgba(34,197,94,.35); transform:scale(1.08); }
      100%{ text-shadow:0 0 0 rgba(56,189,248,0); transform:scale(1); }
    }
    .xpGlow{ animation: xpGlow 520ms ease-out; display:inline-block; }

    @keyframes badgePop{
      0%{ transform:scale(.9); filter:brightness(1); }
      35%{ transform:scale(1.18); filter:brightness(1.35); }
      100%{ transform:scale(1); filter:brightness(1); }
    }
    .badgeUnlock{ animation: badgePop 700ms cubic-bezier(.2,.9,.2,1); }

    .popLayer{
      position:fixed;
      inset:0;
      pointer-events:none;
      z-index:50;
    }
    .popup{
      position:absolute;
      font-weight:900;
      padding:6px 10px;
      border-radius:999px;
      background: rgba(250,204,21,.18);
      border:1px solid rgba(250,204,21,.55);
      color:#fff;
      text-shadow: 0 0 10px rgba(250,204,21,.55);
      transform: translate(-50%, 0);
      opacity:0;
      animation: floatUp 950ms ease-out forwards;
    }
    @keyframes floatUp{
      0%{ opacity:0; transform:translate(-50%,10px) scale(.96); }
      15%{ opacity:1; transform:translate(-50%,0) scale(1.05); }
      100%{ opacity:0; transform:translate(-50%,-52px) scale(1); }
    }

    canvas.confetti{
      position:fixed;
      inset:0;
      width:100%;
      height:100%;
      pointer-events:none;
      z-index:40;
    }
  </style>
</head>

<body>
  <div class="arcadeWrap">
    <header class="arcadeTop">
      <div class="arcadeTitle">
        <div class="kicker">LEGEND ‚Äî ARCADE PROTOTYPE</div>
        <h1>Ohio Constitution ‚Äî Legend Arcade Edition</h1>
        <p class="sub">
          Demo build: XP + levels + streak + sound + confetti/fireworks + ticket.
          (This is for capability testing ‚Äî not the final bundled CS review game.)
        </p>
      </div>
      <div class="meta">
        <div class="pill">XP + Levels ‚úÖ</div>
        <div class="pill">SFX ‚úÖ</div>
        <div class="pill">Confetti/Fireworks ‚úÖ</div>
      </div>
    </header>

    <main class="arcadeCard card" id="arcadeCard">
      <div class="statRow">
        <div class="statGroup">
          <div>XP: <span id="xp">0</span></div>
          <div>Level: <span id="level">1</span></div>
          <div>Streak: <span id="streak">0</span></div>
        </div>
        <div class="badge" id="badge">Reform Rookie</div>
      </div>

      <div class="progressbar"><div class="progress" id="progress"></div></div>

      <div id="question"></div>
      <div id="choices"></div>

      <div class="btnRow">
        <button class="btn primary" type="button" onclick="submit()">Submit</button>
        <button class="btn" type="button" onclick="next()">Next</button>
      </div>

      <div id="ticket"></div>
    </main>
  </div>

  <div class="popLayer" id="popLayer"></div>
  <canvas class="confetti" id="confetti"></canvas>

<script>
/* =========================================================
   LEGEND ARCADE SCRIPT (bells + whistles)
   ========================================================= */

// =========================
// SOUND EFFECTS (synced)
// =========================
const SFX = {
  correct: new Audio("https://assets.mixkit.co/sfx/preview/mixkit-correct-answer-tone-2870.mp3"),
  wrong: new Audio("https://assets.mixkit.co/sfx/preview/mixkit-wrong-answer-fail-notification-946.mp3"),
  level: new Audio("https://assets.mixkit.co/sfx/preview/mixkit-game-level-completed-2059.mp3"),
  boom: new Audio("https://assets.mixkit.co/sfx/preview/mixkit-arcade-game-explosion-2759.mp3"),
  sparkle: new Audio("https://assets.mixkit.co/sfx/preview/mixkit-magical-coin-win-1936.mp3"),
  tick: new Audio("https://assets.mixkit.co/sfx/preview/mixkit-interface-click-1126.mp3")
};
Object.values(SFX).forEach(a => { a.preload = "auto"; a.volume = 0.65; });
SFX.boom.volume = 0.55;
SFX.sparkle.volume = 0.60;
SFX.tick.volume = 0.35;

function playSfx(audio){
  try{
    const a = audio.cloneNode();
    a.volume = audio.volume;
    a.play().catch(()=>{});
  }catch(e){}
}

// Unlock audio on first interaction (browser policy)
let audioUnlocked = false;
function unlockAudioOnce(){
  if(audioUnlocked) return;
  audioUnlocked = true;
  Object.values(SFX).forEach(a=>{
    try{
      const b = a.cloneNode();
      b.volume = 0;
      b.play().then(()=>b.pause()).catch(()=>{});
    }catch(e){}
  });
}
window.addEventListener("pointerdown", unlockAudioOnce, { once:true });

// =========================
// QUESTIONS (demo set)
// =========================
const questions=[
  {q:"Why was the 1851 Ohio Constitution adopted?",a:["To limit legislative power and state debt","To expand slavery","To eliminate courts"],c:0},
  {q:"What reform made judges more accountable in 1851?",a:["Election of judges","Lifetime appointment","Executive selection only"],c:0},
  {q:"Which feature exists in Ohio but not U.S. Constitution?",a:["Initiative and referendum","Bill of Rights","Three branches"],c:0},
  {q:"Initiative allows citizens to‚Ä¶",a:["Propose laws by petition","Appoint judges","Impeach governor"],c:0},
  {q:"Referendum allows citizens to‚Ä¶",a:["Vote on laws passed by legislature","Rewrite federal laws","Control Supreme Court"],c:0},
  {q:"One problem under the 1803 Constitution was‚Ä¶",a:["Legislative dominance","Too many judges","No governor"],c:0},
  {q:"Both Ohio and U.S. Constitutions include‚Ä¶",a:["Separation of powers","Monarchy","Direct democracy only"],c:0},
  {q:"Debt limits were added in 1851 to‚Ä¶",a:["Protect taxpayers","Increase federal control","Expand war spending"],c:0},
  {q:"Attending a school board meeting demonstrates‚Ä¶",a:["Civic responsibility","Judicial review","Military authority"],c:0}
];

// =========================
// STATE
// =========================
let index=0;
let xp=0;
let level=1;
let streak=0;
let bestStreak=0;
let answered=false;
let selectedIdx=null;
const startTime = new Date();

// =========================
// DOM
// =========================
const qDiv=document.getElementById("question");
const cDiv=document.getElementById("choices");
const xpEl=document.getElementById("xp");
const lvlEl=document.getElementById("level");
const streakEl=document.getElementById("streak");
const badgeEl=document.getElementById("badge");
const cardEl=document.getElementById("arcadeCard");
const popLayer=document.getElementById("popLayer");
const progressBar=document.getElementById("progress");
const ticketEl=document.getElementById("ticket");

// =========================
// FX: shake, glow, popups, badge unlock
// =========================
function triggerShake(){
  cardEl.classList.remove("shake");
  void cardEl.offsetWidth;
  cardEl.classList.add("shake");
}

function glowXP(){
  xpEl.classList.remove("xpGlow");
  void xpEl.offsetWidth;
  xpEl.classList.add("xpGlow");
}

function popup(text, anchorEl){
  const r = anchorEl.getBoundingClientRect();
  const p = document.createElement("div");
  p.className = "popup";
  p.textContent = text;
  p.style.left = (r.left + r.width/2) + "px";
  p.style.top = (r.top - 6) + "px";
  popLayer.appendChild(p);
  setTimeout(()=> p.remove(), 1000);
}

function badgeUnlock(newText){
  badgeEl.textContent = newText;
  badgeEl.classList.remove("badgeUnlock");
  void badgeEl.offsetWidth;
  badgeEl.classList.add("badgeUnlock");
  playSfx(SFX.sparkle);
  fireworkBurst(canvas.width/2, canvas.height*0.22, 2.2);
}

function setProgress(){
  progressBar.style.width = Math.round((index / questions.length) * 100) + "%";
}

function updateStats(){
  xpEl.textContent=xp;
  lvlEl.textContent=level;
  streakEl.textContent=streak;
}

// =========================
// RENDER (select + submit)
// =========================
function render(){
  const q = questions[index];
  answered=false;
  selectedIdx=null;

  qDiv.innerHTML = `
    <h3>Question ${index+1} / ${questions.length}</h3>
    <div class="qtext">${q.q}</div>
  `;

  cDiv.innerHTML="";
  q.a.forEach((choice,i)=>{
    const div=document.createElement("div");
    div.className="choice";
    div.textContent=choice;

    div.addEventListener("click", ()=>{
      if(answered) return;
      playSfx(SFX.tick);
      selectedIdx = i;
      [...cDiv.querySelectorAll(".choice")].forEach(x=>x.classList.remove("sel"));
      div.classList.add("sel");
    });

    cDiv.appendChild(div);
  });

  setProgress();
}

// =========================
// SUBMIT & NEXT
// =========================
function submit(){
  if(answered) return;
  if(selectedIdx === null){
    popup("Pick an answer!", lvlEl);
    triggerShake();
    playSfx(SFX.wrong);
    return;
  }

  const q = questions[index];
  const correct = (selectedIdx === q.c);
  const choicesEls = [...cDiv.querySelectorAll(".choice")];
  choicesEls.forEach(el => el.style.pointerEvents="none");

  if(choicesEls[q.c]) choicesEls[q.c].classList.add("correct");
  if(!correct && choicesEls[selectedIdx]) choicesEls[selectedIdx].classList.add("wrong");

  answered = true;

  if(correct){
    playSfx(SFX.correct);

    const gain = 10 + (streak*2);
    xp += gain;
    streak++;
    if(streak > bestStreak) bestStreak = streak;

    glowXP();
    popup(`+${gain} XP`, xpEl);

    const newLevel = 1 + Math.floor(xp / 30);
    if(newLevel > level){
      level = newLevel;
      playSfx(SFX.level);

      if(level >= 8) badgeUnlock("STATEHOUSE LEGEND");
      else if(level >= 6) badgeUnlock("Ohio Icon");
      else if(level >= 4) badgeUnlock("Civic Champion");
      else badgeUnlock("Reform Ranger");

      fireworkBurst(canvas.width/2, canvas.height*0.28, 3.3);
    }

    updateStats();

    // auto-advance on correct
    setTimeout(()=> next(), 650);

  } else {
    playSfx(SFX.wrong);
    triggerShake();
    popup("STREAK BROKEN!", streakEl);
    streak = 0;
    updateStats();
  }
}

function next(){
  if(!answered){
    popup("Submit first!", lvlEl);
    triggerShake();
    return;
  }

  index++;
  if(index >= questions.length){
    celebrate();
    return;
  }

  render();
}

// expose for button onclick
window.submit = submit;
window.next = next;

// =========================
// CONFETTI + FIREWORKS (animated)
// =========================
const canvas = document.getElementById("confetti");
const ctx = canvas.getContext("2d");

let confetti = [];
let fireworks = [];
let animRunning = false;
let animStopAt = 0;
let beatTimer = null;

function resizeCanvas(){
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
window.addEventListener("resize", resizeCanvas);

function startCelebrationFX(durationMs=9500){
  resizeCanvas();
  animStopAt = performance.now() + durationMs;

  confetti = [];
  const count = 240;
  for(let i=0;i<count;i++){
    confetti.push({
      x: Math.random()*canvas.width,
      y: Math.random()*canvas.height - canvas.height,
      size: Math.random()*7+4,
      vx: Math.random()*3-1.5,
      vy: Math.random()*2+2,
      rot: Math.random()*Math.PI*2,
      vr: Math.random()*0.18-0.09,
      color: `hsl(${Math.random()*360}, 100%, 55%)`,
      shape: Math.random()<0.5 ? "rect" : "ribbon"
    });
  }

  fireworkBurst(canvas.width/2, canvas.height*0.38, 4.2);

  if(!animRunning){
    animRunning = true;
    playSfx(SFX.boom);
    requestAnimationFrame(loopFX);
  }

  if(beatTimer) clearInterval(beatTimer);
  beatTimer = setInterval(()=>{
    if(performance.now() < animStopAt) playSfx(SFX.sparkle);
    else { clearInterval(beatTimer); beatTimer = null; }
  }, 1200);
}

function fireworkBurst(x,y,intensity=3){
  const burstCount = Math.floor(55 + intensity*18);
  for(let i=0;i<burstCount;i++){
    const ang = Math.random()*Math.PI*2;
    const spd = (Math.random()*3.0 + 2.2) * intensity;
    fireworks.push({
      x,y,
      vx: Math.cos(ang)*spd,
      vy: Math.sin(ang)*spd,
      life: 70 + Math.random()*30,
      age: 0,
      size: 1.8 + Math.random()*2.4,
      color: `hsl(${Math.random()*360}, 100%, 60%)`
    });
  }
  playSfx(SFX.boom);
}

function loopFX(t){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // confetti
  const g = 0.06;
  confetti.forEach(p=>{
    p.vy += g;
    p.x += p.vx;
    p.y += p.vy;
    p.rot += p.vr;

    if(p.x < -20) p.x = canvas.width+20;
    if(p.x > canvas.width+20) p.x = -20;

    if(p.y > canvas.height+30){
      p.y = -20;
      p.x = Math.random()*canvas.width;
      p.vy = Math.random()*2+2;
    }

    ctx.save();
    ctx.translate(p.x,p.y);
    ctx.rotate(p.rot);
    ctx.fillStyle = p.color;

    if(p.shape === "rect"){
      ctx.fillRect(-p.size/2,-p.size/2,p.size,p.size);
    } else {
      ctx.beginPath();
      ctx.moveTo(-p.size, 0);
      ctx.quadraticCurveTo(0, -p.size, p.size, 0);
      ctx.quadraticCurveTo(0, p.size, -p.size, 0);
      ctx.fill();
    }
    ctx.restore();
  });

  // fireworks
  fireworks = fireworks.filter(f => f.age < f.life);
  fireworks.forEach(f=>{
    f.age++;
    f.vy += 0.04;
    f.vx *= 0.99;
    f.vy *= 0.99;
    f.x += f.vx;
    f.y += f.vy;

    const alpha = Math.max(0, 1 - (f.age / f.life));
    ctx.globalAlpha = alpha;
    ctx.fillStyle = f.color;
    ctx.beginPath();
    ctx.arc(f.x, f.y, f.size, 0, Math.PI*2);
    ctx.fill();
    ctx.globalAlpha = 1;
  });

  if(Math.random() < 0.045){
    fireworkBurst(
      canvas.width*(0.22 + Math.random()*0.56),
      canvas.height*(0.12 + Math.random()*0.28),
      2.0
    );
  }

  if(t < animStopAt){
    requestAnimationFrame(loopFX);
  } else {
    ctx.clearRect(0,0,canvas.width,canvas.height);
    fireworks = [];
    confetti = [];
    animRunning = false;
  }
}

// =========================
// CELEBRATE (ticket)
// =========================
function celebrate(){
  progressBar.style.width = "100%";
  badgeUnlock("STATEHOUSE LEGEND");
  startCelebrationFX(10000);

  const endTime = new Date();
  const runtimeSec = Math.max(0, Math.floor((endTime - startTime)/1000));
  const mm = String(Math.floor(runtimeSec/60)).padStart(2,"0");
  const ss = String(runtimeSec%60).padStart(2,"0");

  ticketEl.innerHTML = `
    <div class="ticket">
      <h2>üèÜ Mastery Complete!</h2>
      XP Earned: <b>${xp}</b><br>
      Level: <b>${level}</b><br>
      Best Streak: <b>${bestStreak}</b><br>
      Started: ${startTime}<br>
      Completed: ${endTime}<br>
      Runtime: <b>${mm}:${ss}</b>
    </div>
  `;

  triggerShake();
}

// init
resizeCanvas();
render();
updateStats();
</script>
</body>
</html>
